import React, {useEffect, useRef} from 'react'
import * as echarts from 'echarts'

export default function Calendar(props) {
  const {className, height = 600, width = '80%'} = props

  const figure = useRef()

  useEffect(() => {
    initChart()  
  }, [])
  
  const initChart = () => {
    let chart = echarts.init(figure.current, 'macarons')
    const nan = null

    const d = [nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      1142.7359532055555,
      nan,
      954.5854291305556,
      nan,
      1473.3599046666673,
      nan,
      837.6948154479168,
      nan,
      118.63092892716662,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      658.0596758447505,
      nan,
      nan,
      nan,
      nan,
      46.77337320188888,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      143.77717252803478,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      378.5142522102779,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      387.59616154229167,
      nan,
      nan,
      nan,
      nan,
      372.1804879940069,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      370.0428422790278,
      nan,
      492.56560818493057,
      nan,
      420.71217747007637,
      nan,
      nan,
      nan,
      nan,
      nan,
      451.3204491627153,
      nan,
      232.6039138549306,
      nan,
      nan,
      nan,
      nan,
      nan,
      307.2668838297499,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      438.626518429014,
      nan,
      337.62659761206237,
      nan,
      nan,
      nan,
      nan,
      274.21790618258336,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      375.76048282031957,
      nan,
      469.25505747049306,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      294.5168137302709,
      nan,
      nan,
      1153.5879266097224,
      nan,
      nan,
      760.247984189688,
      305.5558012260695,
      nan,
      115.68566303156247,
      nan,
      nan,
      nan,
      nan,
      654.2558183101316,
      533.6229729753825,
      583.5609810536388,
      347.1714983215693,
      197.2018781039375,
      99.4994703969514,
      nan,
      601.7577317235904,
      nan,
      190.82445492614588,
      nan,
      nan,
      nan,
      329.6079572907986,
      458.6339325179028,
      nan,
      nan,
      nan,
      394.2417163536803,
      nan,
      595.5986087948472,
      nan,
      nan,
      nan,
      nan,
      nan,
      499.40167836596487,
      475.31559784014604,
      403.5100620809443,
      nan,
      393.8528368948472,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      405.78658440358316,
      nan,
      nan,
      nan,
      nan,
      183.420165625618,
      nan,
      441.57241977531254,
      nan,
      nan,
      nan,
      270.6914932933543,
      279.6271748285972,
      200.6225727746597,
      nan,
      nan,
      413.87536137332637,
      nan,
      nan,
      378.76548024229174,
      401.9929759524931,
      177.56347295424314,
      nan,
      nan,
      405.1465240162013,
      448.4243166883888,
      243.42320223143062,
      507.97970803115277,
      275.1381389655555,
      200.31548144216669,
      691.4351988319169,
      nan,
      1544.2858656722221,
      1033.8148662129377,
      688.0130646109303,
      462.6774731739307,
      514.0234527669373,
      1043.0463011770835,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      198.17898081184723,
      nan,
      nan,
      228.0673610481668,
      nan,
      308.37198782446535,
      nan,
      363.07545629974305,
      323.81241602360416,
      576.6343877677635,
      nan,
      nan,
      nan,
      nan,
      nan,
      591.1841226118471,
      nan,
      915.087894509285,
      654.781474160514,
      593.6487521746944,
      nan,
      325.0783816324375,
      nan,
      nan,
      nan,
      nan,
      526.4729110611111,
      1218.777745785486,
      994.0248023097707,
      1395.8729674596452,
      nan,
      1147.507493622917,
      1334.007738661111,
      1118.4083783486108,
      1308.5996186048612,
      nan,
      nan,
      nan,
      587.6001076056389,
      nan,
      844.7619026447915,
      nan,
      1675.3806709583332,
      1681.4703481805552,
      nan,
      nan,
      nan,
      nan,
      1617.8278853201389,
      1554.689151045834,
      nan,
      1578.9669634305549,
      1530.51148935625,
      1464.8922152888886,
      1568.0544414381932,
      1550.007445313194,
      1576.325001611111,
      nan,
      nan,
      1099.4824793797914,
      1117.8844850322223,
      915.5129452797914,
      864.4867431659727,
      914.6303841248814,
      561.5695295713199,
      398.74262004509046,
      nan,
      509.0623144726946,
      1224.1555324613191,
      nan,
      nan,
      nan,
      nan,
      1663.8453158333334,
      1615.8199366555555,
      nan,
      nan,
      nan,
      1498.791981904861,
      1640.7759088097218,
      1685.7589717111114,
      nan,
      nan,
      nan,
      nan,
      nan,
      1687.9717193680551,
      1711.3898634722216,
      1622.4958132916663,
      nan,
      nan,
      1442.7562302138888,
      nan,
      762.0220851865557,
      468.4983841645348,
      464.04527467786113,
      750.2184069101388,
      nan,
      671.1328626952777,
      nan,
      nan,
      nan,
      1018.0566865131955,
      1136.8599163454862,
      nan,
      1076.6604413330556,
      1669.5877433368053,
      nan,
      nan,
      nan,
      nan,
      1682.3345158819443,
      nan,
      1700.188866972222,
      nan,
      nan,
      nan,
      1269.7282803125,
      nan,
      1455.4655820673606,
      1399.0616332472225,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      203.64876040721526,
      nan,
      nan,
      nan,
      216.65079171609707,
      331.66771040342365,
      96.43519251778474,
      nan,
      nan,
      nan,
      nan,
      nan,
      115.01712577839587,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      157.3482132447847,
      nan,
      231.5797769201042,
      318.86366070400015,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      250.0215745869585,
      627.6302721313195,
      479.6476836604166,
      334.39957005281275,
      nan,
      189.996345263361,
      23.167260684590282,
      32.695957743805565,
      61.686186190611096,
      44.061393982694455,
      nan,
      nan,
      185.96823504150703,
      273.9187658559583,
      295.26119801175696,
      280.20055042813186,
      nan,
      nan,
      nan,
      128.84881860722217,
      nan,
      162.36501262104164,
      353.1011248866736,
      412.70940454922226,
      504.6235730680555,
      386.26689791645845,
      338.2379926175763,
      431.35630280678487,
      549.1266716857359,
      328.7887377004167,
      347.8953355328265,
      465.9501379320137,
      nan,
      642.1146878038195,
      nan,
      nan,
      695.3018579219454,
      234.9272590924513,
      nan,
      nan,
      nan,
      nan,
      nan,
      nan,
      466.42713413234037,
      nan,
      nan,
      281.67411709745835,
      363.41625386802093,
      546.7386277533681,
      279.3450867050834,
      nan,
      nan,
      534.6233625456318,
      487.81589605207654,
      484.3084418713191,
      483.18094560375005,
      528.4380929897914,
      nan,
      381.97632164588197,
      605.7750589180556,
      596.1348482483821,
      782.3156886368054,
      746.2598035059716,
      666.9404536364582,
      431.2486499899653,
      nan,
      286.06075285849306,
      643.2035361993052,
      nan,
      546.8547075702568,
      399.82252962980544,
      622.5970519135276,
      687.9399383161109,
      416.8121378876112,
      169.9682933969028,
      355.260899532007,
      nan,
      692.5100315012293,
      355.0263708933889,
      459.99897358958333,
      789.9411135692359,
      569.1497088595278,
      762.8333571388472,
      840.1908580006948,
      826.6716787748613,
      606.6513238982154,
      574.4540809945415,
      340.7583487413473,
      357.62313361679156,
      490.2661208128541,
      329.33520680479154,
      137.46894358602776,
      214.335636146993,
      621.4810885814858,
      763.0514148741875,
      nan,
      nan,
      471.4935706919238,
      362.75545287989576,
      457.25832149791654,
      295.0794151344028,
      423.268524344243,
      854.4035824828406,
      877.9059397175691,
      932.7178652368057,
      494.3433343212498,
      302.05352028320135,
      83.69689191458332,
      362.63192722298606,
      652.6207575828544,
      439.7039958656804,
      357.87149923933333,
      957.7714785398125,
      964.6980320055557,
      nan,
      nan,
      495.0910929834582,
      483.4926682508059,
      353.134324072,
      470.66124398451404,
      510.64283407755545,
      625.972360620472,
      nan,
      nan,
      263.50594250413195,
      nan,
      50.57795871861807,
      235.70298945472916,
      259.87433147004157,
      469.4541936611457,
      536.6525790941462,
      541.1955564068126,
      495.7728620503194,
      315.2523827192568,
      353.65208932918057,
      580.4469188050693,
      677.0504561823054,
      693.7036626649443,
      599.6975241794239,
      nan,
      nan,
      391.09291022511803,
      396.5756500117152,
      282.88666201047215,
      315.14649659649996,
      517.2572117714931,
      392.74362023527794,
      601.0464948075761,
      644.9791436324373,
      718.6953404383262,
      666.4761571410492,
      793.4619918204098,
      733.1012375386387]
    let idx = 0
    // 指定图表的配置项和数据
    function getVirtulData(year) {
      year = year || '2018'
      let end
      let date = +echarts.number.parseDate(year + '-01-01')
      if (year !== '2020') {
        end = +echarts.number.parseDate(+year + 1 + '-01-01')
      } else {
        end = +echarts.number.parseDate(+year + '-03-30')
      }

      let dayTime = 3600 * 24 * 1000
      let data = []
      for (let time = date; time < end; time += dayTime) {
        data.push([
          echarts.format.formatTime('yyyy-MM-dd', time),
          d[idx]
        ])
        idx += 1
      }
      return data
    }

    chart.setOption({
      title: [
        {
          text: '风电数据日历图',
          // left: 'center',
          // top: 20,
          textStyle: {
            color: 'rgba(195, 66, 62)',
            fontFamily: 'Microsoft YaHei',
            fontSize: 30
          }
        }
      ],
      tooltip: {
        position: 'top'
      },
      toolbox: {
        feature: {
          saveAsImage: {}
        }
      },
      visualMap: {
        min: 0,
        max: 2000,
        calculable: true,
        orient: 'horizontal',
        left: 'center',
        top: 'top'
      },
      calendar: [
        {
          range: '2018',
          cellSize: [20, 20]
        },
        {
          top: 260,
          range: '2019',
          cellSize: [20, 20]
        },
        {
          top: 450,
          range: '2020',
          cellSize: [20, 20],
        }
      ],
      series: [
        {
          type: 'heatmap',
          coordinateSystem: 'calendar',
          calendarIndex: 0,
          data: getVirtulData('2018')
        },
        {
          type: 'heatmap',
          coordinateSystem: 'calendar',
          calendarIndex: 1,
          data: getVirtulData('2019')
        },
        {
          type: 'heatmap',
          coordinateSystem: 'calendar',
          calendarIndex: 2,
          data: getVirtulData('2020')
        }
      ]
    })
  }
  
  return (
    <div ref={figure} className={{className}} style={{height:height,width:width}} />
  )
}
